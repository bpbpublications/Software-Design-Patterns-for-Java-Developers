const h = require('http')
const cr = require('crypto')
const m = new Map()
const s = h.createServer((q, r) => {
  const sd = q.headers['cookie']
  if (sd === undefined) {
    const hash = cr.createHash('md4')
    const sk = hash.digest('hex').substring(0, 10)
    const sv = 'my session data'
    m.set(sk, sv)
    r.setHeader('set-cookie', [ `${sk}=${sv}`])
    r.end('cookie sent')
  } else {
    const k = sd.split('=')[0]
    r.end(`session: ${k}, ${m.get(k)}`)
  }
})
s.listen(12000)
